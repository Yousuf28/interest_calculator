[{"name":"app.R","content":"# Car Loan Interest Calculator - Shiny App\n# Allows user to input loan amount and term, shows comparison table\n\nlibrary(shiny)\nlibrary(DT)\n\n# ============================================================================\n# Calculation Functions\n# ============================================================================\n\n#' Calculate monthly payment for a loan\n#' @param principal Loan amount\n#' @param apr Annual percentage rate (as percentage, e.g., 5 for 5%)\n#' @param months Loan term in months\n#' @return Monthly payment amount\ncalculate_monthly_payment <- function(principal, apr, months) {\n  if (apr == 0) {\n    return(principal / months)\n  } else {\n    monthly_rate <- apr / 100 / 12\n    payment <- principal * (monthly_rate * (1 + monthly_rate)^months) / \n               ((1 + monthly_rate)^months - 1)\n    return(payment)\n  }\n}\n\n#' Calculate loan details for a single APR rate\n#' @param principal Loan amount\n#' @param apr Annual percentage rate\n#' @param months Loan term in months\n#' @return List with APR, monthly payment, total paid, and total interest\ncalculate_loan_details <- function(principal, apr, months) {\n  monthly_payment <- calculate_monthly_payment(principal, apr, months)\n  total_paid <- monthly_payment * months\n  total_interest <- total_paid - principal\n  \n  return(list(\n    APR = apr,\n    Monthly_Payment = monthly_payment,\n    Total_Paid = total_paid,\n    Total_Interest = total_interest\n  ))\n}\n\n#' Calculate loan details for multiple APR rates\n#' @param principal Loan amount\n#' @param months Loan term in months\n#' @param apr_rates Vector of APR rates to calculate\n#' @return Data frame with loan details for each APR rate\ncalculate_all_loan_details <- function(principal, months, apr_rates = seq(0, 6, by = 0.5)) {\n  # Calculate for each APR\n  loan_list <- lapply(apr_rates, function(apr) {\n    calculate_loan_details(principal, apr, months)\n  })\n  \n  # Convert to data frame\n  loan_df <- do.call(rbind, lapply(loan_list, function(x) {\n    data.frame(\n      APR = x$APR,\n      Monthly_Payment = x$Monthly_Payment,\n      Total_Paid = x$Total_Paid,\n      Total_Interest = x$Total_Interest,\n      stringsAsFactors = FALSE\n    )\n  }))\n  \n  # Calculate difference from previous row (consecutive APR rates)\n  loan_df$Difference_From_Previous <- c(0, diff(loan_df$Total_Paid))\n  \n  return(loan_df)\n}\n\n# ============================================================================\n# Formatting Functions\n# ============================================================================\n\n#' Format currency value\n#' @param value Numeric value\n#' @return Formatted string with $ and commas\nformat_currency <- function(value) {\n  paste0(\"$\", format(round(value, 2), nsmall = 2, big.mark = \",\"))\n}\n\n#' Format percentage value\n#' @param value Numeric value (e.g., 0.05 for 5%)\n#' @param decimals Number of decimal places\n#' @return Formatted string with % sign\nformat_percentage <- function(value, decimals = 2) {\n  paste0(format(round(value, decimals), nsmall = decimals), \"%\")\n}\n\n#' Format difference display (shows \"-\" for first row)\n#' @param diff_value Difference value\n#' @param apr APR value to check if it's the first row\n#' @return Formatted string\nformat_difference <- function(diff_value, apr) {\n  if (diff_value == 0 && apr == 0) {\n    return(\"-\")\n  } else {\n    return(format_currency(diff_value))\n  }\n}\n\n# ============================================================================\n# Table Creation Functions\n# ============================================================================\n\n#' Create detailed breakdown data frame for display\n#' @param loan_df Data frame with loan calculations\n#' @param loan_amount Original loan amount\n#' @return Formatted data frame for DataTable\ncreate_detailed_table <- function(loan_df, loan_amount) {\n  data.frame(\n    APR = paste0(loan_df$APR, \"%\"),\n    APR_Sort = loan_df$APR,  # Numeric value for sorting (hidden)\n    `Monthly Payment` = format_currency(loan_df$Monthly_Payment),\n    `Total Interest` = format_currency(loan_df$Total_Interest),\n    `Total Paid` = format_currency(loan_df$Total_Paid),\n    `Interest as % of Loan` = format_percentage(loan_df$Total_Interest / loan_amount * 100),\n    `Difference from Previous Rate` = mapply(format_difference, \n                                             loan_df$Difference_From_Previous, \n                                             loan_df$APR),\n    check.names = FALSE\n  )\n}\n\n#' Create summary text\n#' @param loan_df Data frame with loan calculations\n#' @param loan_amount Original loan amount\n#' @param term_months Loan term in months\n#' @return Formatted summary text string\ncreate_summary_text <- function(loan_df, loan_amount, term_months) {\n  min_interest <- min(loan_df$Total_Interest)\n  max_interest <- max(loan_df$Total_Interest)\n  min_payment <- min(loan_df$Monthly_Payment)\n  max_payment <- max(loan_df$Monthly_Payment)\n  \n  # Get 1.5% to 2% difference\n  apr_1_5_paid <- loan_df$Total_Paid[loan_df$APR == 1.5]\n  apr_2_paid <- loan_df$Total_Paid[loan_df$APR == 2]\n  diff_1_5_to_2 <- if (length(apr_1_5_paid) > 0 && length(apr_2_paid) > 0) {\n    apr_2_paid - apr_1_5_paid\n  } else {\n    0\n  }\n  \n  paste0(\n    \"Loan Amount: \", format_currency(loan_amount), \"\\n\",\n    \"Term: \", term_months, \" months\\n\\n\",\n    \"Interest Range:\\n\",\n    \"  Minimum (0% APR): \", format_currency(min_interest), \"\\n\",\n    \"  Maximum (6% APR): \", format_currency(max_interest), \"\\n\\n\",\n    \"Monthly Payment Range:\\n\",\n    \"  Minimum (0% APR): \", format_currency(min_payment), \"\\n\",\n    \"  Maximum (6% APR): \", format_currency(max_payment), \"\\n\\n\",\n    \"Cost Comparison (1.5% vs 2% APR):\\n\",\n    \"  At 1.5% APR: \", format_currency(apr_1_5_paid), \"\\n\",\n    \"  At 2% APR: \", format_currency(apr_2_paid), \"\\n\",\n    \"  Additional Cost (1.5% to 2%): \", format_currency(diff_1_5_to_2)\n  )\n}\n\n# ============================================================================\n# UI\n# ============================================================================\n\nui <- fluidPage(\n  titlePanel(\"Car Loan Interest Calculator\"),\n  \n  sidebarLayout(\n    sidebarPanel(\n      h4(\"Loan Parameters\"),\n      numericInput(\"loan_amount\", \n                   \"Loan Amount ($):\", \n                   value = 40000, \n                   min = 1000, \n                   max = 1000000, \n                   step = 1000),\n      numericInput(\"term_months\", \n                   \"Loan Term (months):\", \n                   value = 60, \n                   min = 12, \n                   max = 120, \n                   step = 6),\n      br(),\n      h5(\"APR Range: 0% to 6%\"),\n      p(\"The table shows loan details for different APR rates.\"),\n      p(\"The 'Difference from Previous Rate' column shows how much more you pay when moving from one APR rate to the next (e.g., from 1.5% to 2%).\")\n    ),\n    \n    mainPanel(\n      h4(\"Detailed Breakdown\"),\n      DT::dataTableOutput(\"detailed_table\"),\n      br(),\n      h4(\"Summary\"),\n      verbatimTextOutput(\"summary\")\n    )\n  )\n)\n\n# ============================================================================\n# Server\n# ============================================================================\n\nserver <- function(input, output) {\n  \n  # Calculate loan data for all APR rates\n  loan_data <- reactive({\n    calculate_all_loan_details(\n      principal = input$loan_amount,\n      months = input$term_months\n    )\n  })\n  \n  # Detailed breakdown table\n  output$detailed_table <- DT::renderDataTable({\n    df <- loan_data()\n    detailed_df <- create_detailed_table(df, input$loan_amount)\n    \n    DT::datatable(\n      detailed_df,\n      options = list(\n        pageLength = 15,\n        dom = 't',\n        order = list(list(1, 'asc')),  # Sort by numeric APR value (hidden column 1)\n        columnDefs = list(\n          list(visible = FALSE, targets = 1),  # Hide the numeric APR column\n          list(className = 'dt-center', targets = c(0, 2, 3, 4, 5, 6))\n        )\n      ),\n      rownames = FALSE,\n      filter = 'none'\n    ) %>%\n      DT::formatStyle(\n        columns = c(0, 2, 3, 4, 5, 6),\n        textAlign = 'center'\n      ) %>%\n      DT::formatStyle(\n        'Difference from Previous Rate',\n        backgroundColor = DT::styleInterval(\n          cuts = c(-0.01, 0.01),\n          values = c('lightgreen', 'lightyellow', 'lightcoral')\n        )\n      )\n  })\n  \n  # Summary output\n  output$summary <- renderText({\n    df <- loan_data()\n    create_summary_text(df, input$loan_amount, input$term_months)\n  })\n}\n\n# Run the application\nshinyApp(ui = ui, server = server)\n","type":"text"}]
